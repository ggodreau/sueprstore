# Superstore Transformer

Script to transform the [2017/2018 Superstore Tableau
dataset](https://community.tableau.com/thread/316509) into a 5-table
pseudo-normalized star-schema database. The script serves two purposes:

1. To move from a flat OLAP table to an OLTP table for joining and SQL exercises
1. To serve as a document of transformations from the source data set should we
   need to correct errors and/or modify the resultant set in the future

The dataset originally has 51,290 rows. In its transformed state, it has the
following resultant tables:

- Orders: 51,290 rows (transaction hub / fact table)
- Products: 10,292 rows
- Regions: 3,189 rows
- Returns: 4,642 rows
- Customers: 1,590 rows

## Dependencies

You will need Python 3.5+, pandas, and scipy. Please be sure `which python`
returns Python 3.5+.

## Folder Structure

- `src` - transformation functions
- `src/data` - contains _input_ data files, do not modify
- `src/out` - contains _output_ data files to be used in curriculum
- `src/util` - helper utilities common to root src files
- `src/config` - configuration and lookup files used during transformation

## Deriving Tables

To derive tables, clone this repository and enter the root directory. From there, run:

```
chmod +x ./run.sh && ./run.sh
```

From there, you should see the following:

```
01/26/2020 02:14:36 PM Reading in files from src/data...
01/26/2020 02:14:39 PM Beginning transformation...
01/26/2020 02:14:39 PM Transforming 51290 records in get_product_cost_to_consumer...
01/26/2020 02:14:44 PM Transforming 51290 records in get_country_code...
01/26/2020 02:14:44 PM Transforming 51290 records in get_salesperson...
01/26/2020 02:14:44 PM Transforming 51290 records in get_return_date...
01/26/2020 02:14:44 PM Transforming 51290 records in get_return_quantity...
01/26/2020 02:14:52 PM Transforming 51290 records in get_reason_returned...
01/26/2020 02:14:58 PM Transforming 51290 records in get_discount...
01/26/2020 02:15:03 PM Transforming 51290 records in get_postal_code...
01/26/2020 02:15:03 PM Beginning normalization...
01/26/2020 02:15:03 PM Normalizing data in normalize_orders...
01/26/2020 02:15:03 PM Returned 51290 records in normalize_orders...
01/26/2020 02:15:04 PM Normalizing data in normalize_products...
01/26/2020 02:15:14 PM Returned 10292 records in normalize_products...
01/26/2020 02:15:14 PM Normalizing data in normalize_regions...
01/26/2020 02:15:15 PM Retrieving postal code in get_postal_code...
01/26/2020 02:15:15 PM Returned 3819 records in normalize_regions...
01/26/2020 02:15:15 PM Normalizing data in normalize_returns...
01/26/2020 02:15:30 PM Returned 4642 records in normalize_returns...
01/26/2020 02:15:30 PM Normalizing data in normalize_customers...
01/26/2020 02:15:35 PM Returned 1590 records in normalize_customers...
01/26/2020 02:15:35 PM Successfully wrote files to ./src/out
```

After that, your files should be written to `src/out` as a series of `.csv` files.
